<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>GW-BASIC with Virtual Keyboard</title>
  <link rel="stylesheet" href="jsdos/js-dos.css">
  <style>
    body, html { margin:0; height:100%; background:#000; display:flex; flex-direction:column; }
    #dosbox { flex:1; width:100%; height:100%; display:block; }
    #keyboard { background:#222; padding:10px; display:grid; grid-template-columns: repeat(14, 1fr); gap:4px; }
    .key { background:#444; color:#fff; border:none; border-radius:4px; padding:8px; font-size:14px; cursor:pointer; }
    .key:active { background:#666; }
    .wide { grid-column: span 2; }
    .space { grid-column: span 5; }
  </style>
</head>
<body>
  <canvas id="dosbox"></canvas>

  <!-- Virtual keyboard -->
  <div id="keyboard"></div>

  <script src="jsdos/js-dos.js"></script>
  <script>
    let ci;
    const canvas = document.getElementById("dosbox");

    // Start js-dos
    Dos(canvas, { wdosboxUrl: "jsdos/wdosbox.js" })
      .ready((fs, main, control) => {
        ci = control;
        fs.extract("basic.zip").then(() => {
          main(["-c", "mount c .", "-c", "c:", "-c", "cd gwbasic", "-c", "gwbasic"]);
        });
      });

    // Define keyboard layout
    const layout = [
      ["Esc","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","-","=","Backspace"],
      ["Tab","Q","W","E","R","T","Y","U","I","O","P","[","]","Enter"],
      ["Caps","A","S","D","F","G","H","J","K","L",";","'","\\",""],
      ["Shift","Z","X","C","V","B","N","M",",",".","/","Shift","",""],
      ["Ctrl","Alt","Space","Alt","Ctrl","","","","","","","","",""]
    ];

    const keymap = {
      "Backspace":8,"Tab":9,"Enter":13,"Esc":27,
      "Shift":16,"Ctrl":17,"Alt":18,"Caps":20,"Space":32,
      "ArrowLeft":37,"ArrowUp":38,"ArrowRight":39,"ArrowDown":40
    };

    // Build keyboard DOM
    const kb = document.getElementById("keyboard");
    layout.forEach(row => {
      row.forEach(k => {
        if(k==="") {
          const empty = document.createElement("div");
          kb.appendChild(empty);
          return;
        }
        const btn = document.createElement("button");
        btn.className = "key";
        btn.textContent = k;
        if(k==="Backspace") btn.classList.add("wide");
        if(k==="Enter") btn.classList.add("wide");
        if(k==="Space") btn.classList.add("space");
        btn.addEventListener("click", () => sendKey(k));
        kb.appendChild(btn);
      });
    });

    function sendKey(k) {
      if(!ci) return;
      if(k.length===1) {
        ci.sendKeyPress(k.charCodeAt(0));
      } else if(keymap[k]) {
        ci.sendKeyEvent({type:"keydown", code:keymap[k]});
        ci.sendKeyEvent({type:"keyup", code:keymap[k]});
      }
    }
  </script>
</body>
</html>
