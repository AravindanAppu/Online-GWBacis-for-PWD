<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GW-BASIC Virtual Keyboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://js-dos.com/6.22/current/js-dos.js"></script>
<style>
body {
  background: black;
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  font-family: 'Courier New', monospace;
}
#screen-container {
  width: 100vw;
  height: 45vh;
}
#dos-root {
  width: 100%;
  height: 100%;
  border: 2px solid #666;
}
#keyboard-container {
  width: 100vw;
  height: 50vh;
  background: #333;
  display: flex;
  flex-direction: column;
  padding: 4px;
  box-sizing: border-box;
  gap: 4px;
}
.key-row {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 4px;
}
.key {
  background: #444;
  color: white;
  font-size: 1.2em;
  font-weight: bold;
  text-align: center;
  border-radius: 6px;
  flex: 1;
  min-width: 32px;
  padding: 10px 0;
  cursor: pointer;
  user-select: none;
}
.key:active {
  background: #777;
  transform: translateY(1px);
}
.special {
  flex: 1.5;
  background: #4a3c1c;
}
.wide {
  flex: 3;
}
.shift {
  background: #220022;
}
.symbol {
  background: #3c1361;
}
.fkey {
  font-size: 0.8em;
  font-weight: normal;
}
.shift-on {
  background: #660066 !important;
}
</style>
</head>
<body>
<div id="screen-container">
  <canvas id="dos-root"></canvas>
</div>

<div id="keyboard-container">

  <!-- Numbers row -->
  <div class="key-row">
    <div class="key" data-key="1">1</div>
    <div class="key" data-key="2">2</div>
    <div class="key" data-key="3">3</div>
    <div class="key" data-key="4">4</div>
    <div class="key" data-key="5">5</div>
    <div class="key" data-key="6">6</div>
    <div class="key" data-key="7">7</div>
    <div class="key" data-key="8">8</div>
    <div class="key" data-key="9">9</div>
    <div class="key" data-key="0">0</div>
  </div>

  <!-- QWERTY row -->
  <div class="key-row">
    <div class="key" data-key="Q">Q</div>
    <div class="key" data-key="W">W</div>
    <div class="key" data-key="E">E</div>
    <div class="key" data-key="R">R</div>
    <div class="key" data-key="T">T</div>
    <div class="key" data-key="Y">Y</div>
    <div class="key" data-key="U">U</div>
    <div class="key" data-key="I">I</div>
    <div class="key" data-key="O">O</div>
    <div class="key" data-key="P">P</div>
  </div>

  <!-- ASDF row -->
  <div class="key-row">
    <div class="key" data-key="A">A</div>
    <div class="key" data-key="S">S</div>
    <div class="key" data-key="D">D</div>
    <div class="key" data-key="F">F</div>
    <div class="key" data-key="G">G</div>
    <div class="key" data-key="H">H</div>
    <div class="key" data-key="J">J</div>
    <div class="key" data-key="K">K</div>
    <div class="key" data-key="L">L</div>
    <div class="key special" data-key="ENTER">ENTER</div>
  </div>

  <!-- ZXCV row -->
  <div class="key-row">
    <div class="key shift" id="shift-btn" onclick="toggleShift()">SHIFT</div>
    <div class="key" data-key="Z">Z</div>
    <div class="key" data-key="X">X</div>
    <div class="key" data-key="C">C</div>
    <div class="key" data-key="V">V</div>
    <div class="key" data-key="B">B</div>
    <div class="key" data-key="N">N</div>
    <div class="key" data-key="M">M</div>
    <div class="key special" data-key="DEL">DEL</div>
  </div>

  <!-- Symbols + Space -->
  <div class="key-row">
    <div class="key symbol" data-key=";">;</div>
    <div class="key symbol" data-key="'">'</div>
    <div class="key symbol" data-key=",">,</div>
    <div class="key symbol" data-key=".">.</div>
    <div class="key symbol" data-key="/">/</div>
    <div class="key wide special" data-key="SPACE">SPACE</div>
  </div>

</div>

<script>
const dosRoot = document.getElementById("dos-root");
let ci = null;
let shiftOn = false;

// Map normal vs shifted characters
const keyMap = {
  "1": ["1", "!"], "2": ["2", "@"], "3": ["3", "#"], "4": ["4", "$"],
  "5": ["5", "%"], "6": ["6", "^"], "7": ["7", "&"], "8": ["8", "*"],
  "9": ["9", "("], "0": ["0", ")"],
  ";": [";", ":"], "'": ["'", "\""], ",": [",", "<"], ".": [".", ">"],
  "/": ["/", "?"],
  "SPACE": [" ", " "],
  "ENTER": ["\r", "\r"],
  "DEL": ["\b", "\b"]
};

Dos(dosRoot, {
  wdosboxUrl: "https://js-dos.com/6.22/current/wdosbox.js"
}).ready((fs, main) => {
  fs.extract("basic.zip").then(() => {
    main(["-c","mount d .","-c","d:","-c","cd gwbasic","-c","gwbasic"])
      .then(client => ci = client);
  });
});

function toggleShift(){
  shiftOn = !shiftOn;
  document.getElementById("shift-btn").classList.toggle("shift-on", shiftOn);
}

function sendKeys(char){
  if(!ci) return;
  navigator.vibrate?.(20); // haptic feedback
  let output = char;

  if(keyMap[char]){
    output = shiftOn ? keyMap[char][1] : keyMap[char][0];
  } else if(char.length === 1){
    output = shiftOn ? char.toUpperCase() : char.toLowerCase();
  }

  const code = output.charCodeAt(0);
  ci.simulateKeyPress(code);

  if(shiftOn && char.length === 1){ // auto-reset shift like mobile keyboard
    toggleShift();
  }
}

// Attach to all keys
document.querySelectorAll(".key").forEach(k=>{
  if(!k.dataset.key) return;
  k.addEventListener("click", ()=>sendKeys(k.dataset.key));
});
</script>
</body>
</html>
