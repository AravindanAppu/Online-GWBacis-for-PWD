<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GW-BASIC Virtual Keyboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://js-dos.com/6.22/current/js-dos.js"></script>
<style>
body {
  background: black;
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  font-family: 'Courier New', monospace;
}
#screen-container {
  width: 100vw;
  height: 45vh;
}
#dos-root {
  width: 100%;
  height: 100%;
  border: 2px solid #666;
}
#keyboard-container {
  width: 100vw;
  height: 50vh;
  background: #333;
  display: flex;
  flex-direction: column;
  padding: 6px;
  padding-bottom: env(safe-area-inset-bottom); /* ‚úÖ supports curved screens / notch */
  box-sizing: border-box;
  gap: 4px;
  position: fixed;
  bottom: 0;
  left: 0;
}
.key-row {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 4px;
}
.key {
  background: #444;
  color: white;
  font-size: 1.1em;
  font-weight: bold;
  text-align: center;
  border-radius: 6px;
  flex: 1;
  min-width: 32px;
  padding: 10px 0;
  cursor: pointer;
  user-select: none;
}
.key:active {
  background: #777;
  transform: translateY(1px);
}
.special { flex: 1.5; background: #4a3c1c; }
.wide { flex: 3; }
.fkey { font-size: 0.8em; font-weight: normal; }
.shift-active { background: #a67c00 !important; } /* ‚úÖ highlight when SHIFT is active */
</style>
</head>
<body>
<div id="screen-container">
  <canvas id="dos-root"></canvas>
</div>

<div id="keyboard-container">

  <!-- Function keys -->
  <div class="key-row">
    <div class="key fkey" onclick="sendKeys(112)">F1</div>
    <div class="key fkey" onclick="sendKeys(113)">F2</div>
    <div class="key fkey" onclick="sendKeys(114)">F3</div>
    <div class="key fkey" onclick="sendKeys(115)">F4</div>
    <div class="key fkey" onclick="sendKeys(116)">F5</div>
    <div class="key fkey" onclick="sendKeys(117)">F6</div>
    <div class="key fkey" onclick="sendKeys(118)">F7</div>
    <div class="key fkey" onclick="sendKeys(119)">F8</div>
    <div class="key fkey" onclick="sendKeys(120)">F9</div>
    <div class="key fkey" onclick="sendKeys(121)">F10</div>
  </div>

  <!-- Numbers row -->
  <div class="key-row">
    <div class="key" onclick="sendKeys(49)">1</div>
    <div class="key" onclick="sendKeys(50)">2</div>
    <div class="key" onclick="sendKeys(51)">3</div>
    <div class="key" onclick="sendKeys(52)">4</div>
    <div class="key" onclick="sendKeys(53)">5</div>
    <div class="key" onclick="sendKeys(54)">6</div>
    <div class="key" onclick="sendKeys(55)">7</div>
    <div class="key" onclick="sendKeys(56)">8</div>
    <div class="key" onclick="sendKeys(57)">9</div>
    <div class="key" onclick="sendKeys(48)">0</div>
  </div>

  <!-- QWERTY row -->
  <div class="key-row">
    <div class="key" onclick="sendKeys(81)">Q</div>
    <div class="key" onclick="sendKeys(87)">W</div>
    <div class="key" onclick="sendKeys(69)">E</div>
    <div class="key" onclick="sendKeys(82)">R</div>
    <div class="key" onclick="sendKeys(84)">T</div>
    <div class="key" onclick="sendKeys(89)">Y</div>
    <div class="key" onclick="sendKeys(85)">U</div>
    <div class="key" onclick="sendKeys(73)">I</div>
    <div class="key" onclick="sendKeys(79)">O</div>
    <div class="key" onclick="sendKeys(80)">P</div>
  </div>

  <!-- ASDF row -->
  <div class="key-row">
    <div class="key" onclick="sendKeys(65)">A</div>
    <div class="key" onclick="sendKeys(83)">S</div>
    <div class="key" onclick="sendKeys(68)">D</div>
    <div class="key" onclick="sendKeys(70)">F</div>
    <div class="key" onclick="sendKeys(71)">G</div>
    <div class="key" onclick="sendKeys(72)">H</div>
    <div class="key" onclick="sendKeys(74)">J</div>
    <div class="key" onclick="sendKeys(75)">K</div>
    <div class="key" onclick="sendKeys(76)">L</div>
    <div class="key special" onclick="sendKeys(13)">‚èé</div>
  </div>

  <!-- ZXCV row -->
  <div class="key-row">
    <div id="shift-key" class="key special" onclick="sendKeys(16)">‚áß</div>
    <div class="key" onclick="sendKeys(90)">Z</div>
    <div class="key" onclick="sendKeys(88)">X</div>
    <div class="key" onclick="sendKeys(67)">C</div>
    <div class="key" onclick="sendKeys(86)">V</div>
    <div class="key" onclick="sendKeys(66)">B</div>
    <div class="key" onclick="sendKeys(78)">N</div>
    <div class="key" onclick="sendKeys(77)">M</div>
    <div class="key special" onclick="sendKeys(8)">‚å´</div>
  </div>

  <!-- Space + basic symbols -->
  <div class="key-row">
    <div class="key" onclick="sendKeys(190)">.</div>
    <div class="key" onclick="sendKeys(188)">,</div>
    <div class="key" onclick="sendKeys(191)">/</div>
    <div class="key wide special" onclick="sendKeys(32)">SPACE</div>
    <div class="key" onclick="sendKeys(186)">;</div>
    <div class="key" onclick="sendKeys(222)">'</div>
    <div class="key" onclick="sendKeys(189)">-</div>
    <div class="key" onclick="sendKeys(187)">=</div>
  </div>

</div>

<script>
const dosRoot = document.getElementById("dos-root");
let ci = null;
let shiftActive = false; // ‚úÖ Track shift toggle
const shiftKeyEl = document.getElementById("shift-key");

Dos(dosRoot, {
  wdosboxUrl: "https://js-dos.com/6.22/current/wdosbox.js"
}).ready((fs, main) => {
  fs.extract("basic.zip").then(() => {
    main(["-c","mount d .","-c","d:","-c","cd gwbasic","-c","gwbasic"])
      .then(client => ci = client);
  });
});

function sendKeys(code) {
  if (!ci) return;

  if (code === 16) { 
    // Toggle SHIFT
    shiftActive = !shiftActive;
    shiftKeyEl.classList.toggle("shift-active", shiftActive);
    return;
  }

  if (shiftActive) {
    if (code >= 65 && code <= 90) {
      ci.simulateKeyPress(code); // already uppercase
    } else {
      const shiftedMap = {
        49: 33,   // 1 ‚Üí !
        50: 64,   // 2 ‚Üí @
        51: 35,   // 3 ‚Üí #
        52: 36,   // 4 ‚Üí $
        53: 37,   // 5 ‚Üí %
        54: 94,   // 6 ‚Üí ^
        55: 38,   // 7 ‚Üí &
        56: 42,   // 8 ‚Üí *
        57: 40,   // 9 ‚Üí (
        48: 41,   // 0 ‚Üí )
        186: 58,  // ; ‚Üí :
        222: 34,  // ' ‚Üí "
        188: 60,  // , ‚Üí <
        190: 62,  // . ‚Üí >
        191: 63,  // / ‚Üí ?
        189: 95,  // - ‚Üí _
        187: 43   // = ‚Üí +
      };
      if (shiftedMap[code]) {
        ci.simulateKeyPress(shiftedMap[code]);
      } else {
        ci.simulateKeyPress(code);
      }
    }
    shiftActive = false;
    shiftKeyEl.classList.remove("shift-active");
  } else {
    ci.simulateKeyPress(code);
  }

  if (navigator.vibrate) navigator.vibrate(20);
}

// üîä Fix for AudioContext autoplay policy
document.addEventListener("click", () => {
  if (ci && ci.audioContext && ci.audioContext.state === "suspended") {
    ci.audioContext.resume();
  }
}, { once: true });
</script>
</body>
</html>
