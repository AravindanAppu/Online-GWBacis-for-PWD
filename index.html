<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GW-BASIC Android Keyboard</title>
<link rel="stylesheet" href="jsdos/js-dos.css">
<style>
  body, html { margin:0; height:100%; background:#000; display:flex; flex-direction:column; }
  #dosbox { flex:1; width:100%; height:100%; display:block; }
  #startBtn { position:fixed; bottom:10px; left:10px; z-index:1000; padding:10px 20px; font-size:16px; }
  #hiddenInput { position:absolute; opacity:0; width:1px; height:1px; top:0; left:0; }
</style>
</head>
<body>

<button id="startBtn">Start GW-BASIC</button>
<input id="hiddenInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
<canvas id="dosbox"></canvas>

<script src="jsdos/js-dos.js"></script>
<script>
const startBtn = document.getElementById("startBtn");
const hiddenInput = document.getElementById("hiddenInput");
const canvas = document.getElementById("dosbox");

let ci;

// Launch GW-BASIC
startBtn.addEventListener("click", () => {
    hiddenInput.focus(); // triggers Google keyboard on Android
    Dos(canvas, { wdosboxUrl: "jsdos/wdosbox.js" }).ready((fs, main, control) => {
        ci = control;
        fs.extract("basic.zip").then(() => {
            main([
                "-c","mount c .",
                "-c","c:",
                "-c","cd gwbasic",
                "-c","gwbasic"
            ]).then(() => {
                canvas.focus();
                console.log("GW-BASIC ready!");
            });
        });
    });
});

// Map Android input to JS-DOS key events
hiddenInput.addEventListener("input", e => {
    if(!ci) return;
    const value = hiddenInput.value;
    for(let char of value){
        // Handle uppercase letters with Shift
        const isUpper = char.toUpperCase() === char && char.toLowerCase() !== char;
        if(isUpper){
            ci.sendKeyEvent({type:"keydown", code:"ShiftLeft"});
        }

        // Map Enter, Backspace, Space
        let code = char.charCodeAt(0);
        if(char === "\n") code = 0x0D; // Enter
        if(char === "\b") code = 0x08; // Backspace
        if(char === " ") code = 0x20;  // Space

        ci.sendKeyEvent({type:"keydown", key:char, keyCode:code});
        ci.simulateKeyPress(code);
        ci.sendKeyEvent({type:"keyup", key:char, keyCode:code});

        if(isUpper){
            ci.sendKeyEvent({type:"keyup", code:"ShiftLeft"});
        }
    }
    hiddenInput.value = ""; // reset after sending
});

// Keep hidden input focused if canvas is tapped
canvas.addEventListener("click", () => hiddenInput.focus());
</script>

</body>
</html>
