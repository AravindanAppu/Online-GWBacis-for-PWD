<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GW-BASIC in Browser</title>
<link rel="stylesheet" href="jsdos/js-dos.css">
<style>
  body, html { margin:0; height:100%; background:#000; display:flex; flex-direction:column; }
  #dosbox { flex:1; width:100%; height:100%; display:block; }
</style>
</head>
<body>

<canvas id="dosbox"></canvas>

<script src="jsdos/js-dos.js"></script>
<script>
const canvas = document.getElementById("dosbox");
let ci;

Dos(canvas, { wdosboxUrl: "jsdos/wdosbox.js" }).ready((fs, main, control) => {
    ci = control;
    fs.extract("basic.zip").then(() => {
        main([
            "-c","mount c .",
            "-c","c:",
            "-c","cd gwbasic",
            "-c","gwbasic"
        ]).then(() => {
            canvas.focus();
            console.log("GW-BASIC ready!");
        });
    });
});

// On-screen virtual keyboard
function createKeyboard() {
    const keys = "1234567890QWERTYUIOPASDFGHJKLZXCVBNM".split("");
    const keyboard = document.createElement("div");
    keyboard.style.position = "absolute";
    keyboard.style.bottom = "0";
    keyboard.style.left = "0";
    keyboard.style.width = "100%";
    keyboard.style.display = "flex";
    keyboard.style.flexWrap = "wrap";
    keyboard.style.background = "#222";
    document.body.appendChild(keyboard);

    keys.forEach(k => {
        const btn = document.createElement("button");
        btn.textContent = k;
        btn.style.flex = "1 0 6%";
        btn.style.margin = "2px";
        btn.style.padding = "10px";
        btn.style.fontSize = "16px";
        btn.addEventListener("click", () => {
            if(!ci) return;
            const code = k.charCodeAt(0);
            ci.sendKeyEvent({type:"keydown", key:k, keyCode:code});
            ci.simulateKeyPress(code);
            ci.sendKeyEvent({type:"keyup", key:k, keyCode:code});
        });
        keyboard.appendChild(btn);
    });
}

createKeyboard();
</script>

</body>
</html>
